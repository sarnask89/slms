<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebGL Interface Browser Plugin Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .test-section h2 {
            margin-top: 0;
            color: #ffd700;
            border-bottom: 2px solid #ffd700;
            padding-bottom: 10px;
        }
        
        .test-button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .test-button.success {
            background: linear-gradient(45deg, #00b894, #00a085);
        }
        
        .test-button.error {
            background: linear-gradient(45deg, #d63031, #c0392b);
        }
        
        .test-button.warning {
            background: linear-gradient(45deg, #fdcb6e, #e17055);
        }
        
        .result-area {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin: 5px;
        }
        
        .status.success {
            background: #00b894;
            color: white;
        }
        
        .status.error {
            background: #d63031;
            color: white;
        }
        
        .status.warning {
            background: #fdcb6e;
            color: black;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00b894, #00a085);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .feature-test {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .feature-test h3 {
            margin-top: 0;
            color: #74b9ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç WebGL Interface Browser Plugin Test</h1>
        
        <div class="test-section">
            <h2>üöÄ System Status</h2>
            <div id="system-status">
                <div class="status" id="apache-status">Checking Apache...</div>
                <div class="status" id="php-status">Checking PHP...</div>
                <div class="status" id="database-status">Checking Database...</div>
                <div class="status" id="webgl-status">Checking WebGL...</div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="system-progress"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üåê API Connectivity Tests</h2>
            <button class="test-button" onclick="testBasicConnectivity()">Test Basic Connectivity</button>
            <button class="test-button" onclick="testAllAPIEndpoints()">Test All API Endpoints</button>
            <button class="test-button" onclick="testPOSTOperations()">Test POST Operations</button>
            <button class="test-button" onclick="testModuleFunctions()">Test Module Functions</button>
            <div class="result-area" id="api-results">API test results will appear here...</div>
        </div>
        
        <div class="test-section">
            <h2>üéÆ WebGL Interface Tests</h2>
            <div class="grid">
                <div class="feature-test">
                    <h3>Core Modules</h3>
                    <button class="test-button" onclick="testModule('clients')">Test Clients</button>
                    <button class="test-button" onclick="testModule('devices')">Test Devices</button>
                    <button class="test-button" onclick="testModule('scan_jobs')">Test Scan Jobs</button>
                </div>
                
                <div class="feature-test">
                    <h3>Network Modules</h3>
                    <button class="test-button" onclick="testModule('core_devices')">Test Core Devices</button>
                    <button class="test-button" onclick="testModule('client_devices')">Test Client Devices</button>
                    <button class="test-button" onclick="testModule('network_segments')">Test Network Segments</button>
                </div>
                
                <div class="feature-test">
                    <h3>Advanced Modules</h3>
                    <button class="test-button" onclick="testModule('mikrotik')">Test Mikrotik</button>
                    <button class="test-button" onclick="testModule('dhcp')">Test DHCP</button>
                    <button class="test-button" onclick="testModule('snmp')">Test SNMP</button>
                </div>
                
                <div class="feature-test">
                    <h3>Infrastructure</h3>
                    <button class="test-button" onclick="testModule('vlans')">Test VLANs</button>
                    <button class="test-button" onclick="testModule('ip_ranges')">Test IP Ranges</button>
                    <button class="test-button" onclick="testModule('device_categories')">Test Categories</button>
                </div>
            </div>
            <div class="result-area" id="webgl-results">WebGL test results will appear here...</div>
        </div>
        
        <div class="test-section">
            <h2>üîß Functionality Tests</h2>
            <button class="test-button" onclick="testCRUDOperations()">Test CRUD Operations</button>
            <button class="test-button" onclick="testSearchFunctionality()">Test Search</button>
            <button class="test-button" onclick="testScanOperations()">Test Scan Operations</button>
            <button class="test-button" onclick="testNetworkOperations()">Test Network Operations</button>
            <div class="result-area" id="functionality-results">Functionality test results will appear here...</div>
        </div>
        
        <div class="test-section">
            <h2>üìä Performance Tests</h2>
            <button class="test-button" onclick="testLoadTime()">Test Load Time</button>
            <button class="test-button" onclick="testMemoryUsage()">Test Memory Usage</button>
            <button class="test-button" onclick="testResponseTime()">Test Response Time</button>
            <button class="test-button" onclick="testConcurrentRequests()">Test Concurrent Requests</button>
            <div class="result-area" id="performance-results">Performance test results will appear here...</div>
        </div>
        
        <div class="test-section">
            <h2>üõ°Ô∏è Security Tests</h2>
            <button class="test-button" onclick="testSQLInjection()">Test SQL Injection</button>
            <button class="test-button" onclick="testXSSVulnerabilities()">Test XSS</button>
            <button class="test-button" onclick="testCSRFProtection()">Test CSRF</button>
            <button class="test-button" onclick="testInputValidation()">Test Input Validation</button>
            <div class="result-area" id="security-results">Security test results will appear here...</div>
        </div>
        
        <div class="test-section">
            <h2>üìã Comprehensive Report</h2>
            <button class="test-button success" onclick="generateComprehensiveReport()">Generate Full Report</button>
            <button class="test-button warning" onclick="exportTestResults()">Export Results</button>
            <div class="result-area" id="comprehensive-results">Comprehensive report will appear here...</div>
        </div>
    </div>

    <script>
        // Global variables
        let testResults = {
            api: {},
            webgl: {},
            functionality: {},
            performance: {},
            security: {}
        };
        
        let systemStatus = {
            apache: false,
            php: false,
            database: false,
            webgl: false
        };

        // Initialize the test environment
        document.addEventListener('DOMContentLoaded', function() {
            log('Browser Plugin Test initialized');
            checkSystemStatus();
        });

        // System status check
        async function checkSystemStatus() {
            const progressBar = document.getElementById('system-progress');
            let progress = 0;
            
            // Check Apache
            try {
                const response = await fetch('webgl_demo_integrated.php');
                if (response.ok) {
                    updateStatus('apache-status', 'Apache: Running', 'success');
                    systemStatus.apache = true;
                } else {
                    updateStatus('apache-status', 'Apache: Error', 'error');
                }
            } catch (error) {
                updateStatus('apache-status', 'Apache: Not accessible', 'error');
            }
            progress += 25;
            progressBar.style.width = progress + '%';
            
            // Check PHP
            try {
                const response = await fetch('webgl_module_integration.php?action=list&module=clients');
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        updateStatus('php-status', 'PHP: Working', 'success');
                        systemStatus.php = true;
                    } else {
                        updateStatus('php-status', 'PHP: API Error', 'warning');
                    }
                } else {
                    updateStatus('php-status', 'PHP: Not responding', 'error');
                }
            } catch (error) {
                updateStatus('php-status', 'PHP: Connection failed', 'error');
            }
            progress += 25;
            progressBar.style.width = progress + '%';
            
            // Check Database
            try {
                const response = await fetch('webgl_module_integration.php?action=list&module=clients');
                const data = await response.json();
                if (data.success && data.data) {
                    updateStatus('database-status', 'Database: Connected', 'success');
                    systemStatus.database = true;
                } else {
                    updateStatus('database-status', 'Database: No data', 'warning');
                }
            } catch (error) {
                updateStatus('database-status', 'Database: Connection failed', 'error');
            }
            progress += 25;
            progressBar.style.width = progress + '%';
            
            // Check WebGL
            if (window.WebGLRenderingContext) {
                updateStatus('webgl-status', 'WebGL: Supported', 'success');
                systemStatus.webgl = true;
            } else {
                updateStatus('webgl-status', 'WebGL: Not supported', 'error');
            }
            progress += 25;
            progressBar.style.width = progress + '%';
        }

        function updateStatus(elementId, text, type) {
            const element = document.getElementById(elementId);
            element.textContent = text;
            element.className = `status ${type}`;
        }

        // API Tests
        async function testBasicConnectivity() {
            log('Testing basic connectivity...', 'api-results');
            
            try {
                const response = await fetch('webgl_demo_integrated.php');
                if (response.ok) {
                    log('‚úÖ Basic connectivity: SUCCESS', 'api-results');
                    testResults.api.connectivity = 'SUCCESS';
                } else {
                    log('‚ùå Basic connectivity: FAILED', 'api-results');
                    testResults.api.connectivity = 'FAILED';
                }
            } catch (error) {
                log('‚ùå Basic connectivity: ERROR - ' + error.message, 'api-results');
                testResults.api.connectivity = 'ERROR';
            }
        }

        async function testAllAPIEndpoints() {
            log('Testing all API endpoints...', 'api-results');
            
            const endpoints = [
                'action=list&module=clients',
                'action=list&module=devices',
                'action=list&module=scan_jobs',
                'action=list&module=core_devices',
                'action=list&module=client_devices',
                'action=get_module_functions&module=scan_jobs'
            ];
            
            testResults.api.endpoints = {};
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(`webgl_module_integration.php?${endpoint}`);
                    const data = await response.json();
                    
                    if (data.success) {
                        log(`‚úÖ ${endpoint}: SUCCESS`, 'api-results');
                        testResults.api.endpoints[endpoint] = 'SUCCESS';
                    } else {
                        log(`‚ùå ${endpoint}: FAILED - ${data.message}`, 'api-results');
                        testResults.api.endpoints[endpoint] = 'FAILED';
                    }
                } catch (error) {
                    log(`‚ùå ${endpoint}: ERROR - ${error.message}`, 'api-results');
                    testResults.api.endpoints[endpoint] = 'ERROR';
                }
            }
        }

        async function testPOSTOperations() {
            log('Testing POST operations...', 'api-results');
            
            try {
                const response = await fetch('webgl_module_integration.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: 'action=execute_module_function&module=scan_jobs&function=start&name=Browser Test&type=network&targets=192.168.1.0/24'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    log('‚úÖ POST operations: SUCCESS', 'api-results');
                    testResults.api.post = 'SUCCESS';
                } else {
                    log('‚ùå POST operations: FAILED - ' + data.message, 'api-results');
                    testResults.api.post = 'FAILED';
                }
            } catch (error) {
                log('‚ùå POST operations: ERROR - ' + error.message, 'api-results');
                testResults.api.post = 'ERROR';
            }
        }

        async function testModuleFunctions() {
            log('Testing module functions...', 'api-results');
            
            const modules = ['clients', 'devices', 'scan_jobs', 'core_devices'];
            testResults.api.functions = {};
            
            for (const module of modules) {
                try {
                    const response = await fetch(`webgl_module_integration.php?action=get_module_functions&module=${module}`);
                    const data = await response.json();
                    
                    if (data.success && data.data.functions) {
                        log(`‚úÖ ${module} functions: ${data.data.functions.length} found`, 'api-results');
                        testResults.api.functions[module] = 'SUCCESS';
                    } else {
                        log(`‚ùå ${module} functions: FAILED`, 'api-results');
                        testResults.api.functions[module] = 'FAILED';
                    }
                } catch (error) {
                    log(`‚ùå ${module} functions: ERROR - ${error.message}`, 'api-results');
                    testResults.api.functions[module] = 'ERROR';
                }
            }
        }

        // WebGL Interface Tests
        async function testModule(moduleName) {
            log(`Testing ${moduleName} module...`, 'webgl-results');
            
            try {
                const response = await fetch(`webgl_module_integration.php?action=list&module=${moduleName}`);
                const data = await response.json();
                
                if (data.success) {
                    log(`‚úÖ ${moduleName}: SUCCESS (${data.total} items)`, 'webgl-results');
                    testResults.webgl[moduleName] = 'SUCCESS';
                } else {
                    log(`‚ùå ${moduleName}: FAILED - ${data.message}`, 'webgl-results');
                    testResults.webgl[moduleName] = 'FAILED';
                }
            } catch (error) {
                log(`‚ùå ${moduleName}: ERROR - ${error.message}`, 'webgl-results');
                testResults.webgl[moduleName] = 'ERROR';
            }
        }

        // Functionality Tests
        async function testCRUDOperations() {
            log('Testing CRUD operations...', 'functionality-results');
            
            const operations = ['list', 'add', 'edit', 'delete'];
            testResults.functionality.crud = {};
            
            for (const operation of operations) {
                try {
                    const response = await fetch(`webgl_module_integration.php?action=${operation}&module=clients`);
                    const data = await response.json();
                    
                    if (data.success || (operation === 'delete' && data.message)) {
                        log(`‚úÖ CRUD ${operation}: SUCCESS`, 'functionality-results');
                        testResults.functionality.crud[operation] = 'SUCCESS';
                    } else {
                        log(`‚ùå CRUD ${operation}: FAILED`, 'functionality-results');
                        testResults.functionality.crud[operation] = 'FAILED';
                    }
                } catch (error) {
                    log(`‚ùå CRUD ${operation}: ERROR - ${error.message}`, 'functionality-results');
                    testResults.functionality.crud[operation] = 'ERROR';
                }
            }
        }

        async function testSearchFunctionality() {
            log('Testing search functionality...', 'functionality-results');
            
            try {
                const response = await fetch('webgl_module_integration.php?action=execute_module_function&module=clients&function=search&search_term=test');
                const data = await response.json();
                
                if (data.success) {
                    log('‚úÖ Search functionality: SUCCESS', 'functionality-results');
                    testResults.functionality.search = 'SUCCESS';
                } else {
                    log('‚ùå Search functionality: FAILED', 'functionality-results');
                    testResults.functionality.search = 'FAILED';
                }
            } catch (error) {
                log('‚ùå Search functionality: ERROR - ' + error.message, 'functionality-results');
                testResults.functionality.search = 'ERROR';
            }
        }

        async function testScanOperations() {
            log('Testing scan operations...', 'functionality-results');
            
            const scanOperations = ['start', 'stop', 'results'];
            testResults.functionality.scan = {};
            
            for (const operation of scanOperations) {
                try {
                    const response = await fetch('webgl_module_integration.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: `action=execute_module_function&module=scan_jobs&function=${operation}&job_id=1`
                    });
                    
                    const data = await response.json();
                    
                    if (data.success || data.message) {
                        log(`‚úÖ Scan ${operation}: SUCCESS`, 'functionality-results');
                        testResults.functionality.scan[operation] = 'SUCCESS';
                    } else {
                        log(`‚ùå Scan ${operation}: FAILED`, 'functionality-results');
                        testResults.functionality.scan[operation] = 'FAILED';
                    }
                } catch (error) {
                    log(`‚ùå Scan ${operation}: ERROR - ${error.message}`, 'functionality-results');
                    testResults.functionality.scan[operation] = 'ERROR';
                }
            }
        }

        async function testNetworkOperations() {
            log('Testing network operations...', 'functionality-results');
            
            const networkOperations = ['ping_range', 'scan_vlan', 'monitor_vlan'];
            testResults.functionality.network = {};
            
            for (const operation of networkOperations) {
                try {
                    const response = await fetch('webgl_module_integration.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: `action=execute_module_function&module=ip_ranges&function=${operation}&id=1`
                    });
                    
                    const data = await response.json();
                    
                    if (data.success || data.message) {
                        log(`‚úÖ Network ${operation}: SUCCESS`, 'functionality-results');
                        testResults.functionality.network[operation] = 'SUCCESS';
                    } else {
                        log(`‚ùå Network ${operation}: FAILED`, 'functionality-results');
                        testResults.functionality.network[operation] = 'FAILED';
                    }
                } catch (error) {
                    log(`‚ùå Network ${operation}: ERROR - ${error.message}`, 'functionality-results');
                    testResults.functionality.network[operation] = 'ERROR';
                }
            }
        }

        // Performance Tests
        async function testLoadTime() {
            log('Testing load time...', 'performance-results');
            
            const startTime = performance.now();
            
            try {
                const response = await fetch('webgl_demo_integrated.php');
                const endTime = performance.now();
                const loadTime = endTime - startTime;
                
                if (response.ok) {
                    log(`‚úÖ Load time: ${loadTime.toFixed(2)}ms`, 'performance-results');
                    testResults.performance.loadTime = loadTime;
                } else {
                    log('‚ùå Load time: FAILED', 'performance-results');
                    testResults.performance.loadTime = 'FAILED';
                }
            } catch (error) {
                log('‚ùå Load time: ERROR - ' + error.message, 'performance-results');
                testResults.performance.loadTime = 'ERROR';
            }
        }

        async function testResponseTime() {
            log('Testing API response time...', 'performance-results');
            
            const startTime = performance.now();
            
            try {
                const response = await fetch('webgl_module_integration.php?action=list&module=clients');
                const endTime = performance.now();
                const responseTime = endTime - startTime;
                
                const data = await response.json();
                
                if (data.success) {
                    log(`‚úÖ API response time: ${responseTime.toFixed(2)}ms`, 'performance-results');
                    testResults.performance.responseTime = responseTime;
                } else {
                    log('‚ùå API response time: FAILED', 'performance-results');
                    testResults.performance.responseTime = 'FAILED';
                }
            } catch (error) {
                log('‚ùå API response time: ERROR - ' + error.message, 'performance-results');
                testResults.performance.responseTime = 'ERROR';
            }
        }

        async function testConcurrentRequests() {
            log('Testing concurrent requests...', 'performance-results');
            
            const requests = [];
            const startTime = performance.now();
            
            for (let i = 0; i < 5; i++) {
                requests.push(fetch('webgl_module_integration.php?action=list&module=clients'));
            }
            
            try {
                const responses = await Promise.all(requests);
                const endTime = performance.now();
                const totalTime = endTime - startTime;
                
                let successCount = 0;
                for (const response of responses) {
                    if (response.ok) successCount++;
                }
                
                log(`‚úÖ Concurrent requests: ${successCount}/5 successful in ${totalTime.toFixed(2)}ms`, 'performance-results');
                testResults.performance.concurrentRequests = `${successCount}/5`;
            } catch (error) {
                log('‚ùå Concurrent requests: ERROR - ' + error.message, 'performance-results');
                testResults.performance.concurrentRequests = 'ERROR';
            }
        }

        // Security Tests
        async function testSQLInjection() {
            log('Testing SQL injection vulnerabilities...', 'security-results');
            
            const maliciousInputs = ["' OR '1'='1", "'; DROP TABLE users; --", "1' UNION SELECT * FROM users --"];
            testResults.security.sqlInjection = {};
            
            for (const input of maliciousInputs) {
                try {
                    const response = await fetch(`webgl_module_integration.php?action=list&module=clients&id=${encodeURIComponent(input)}`);
                    const data = await response.json();
                    
                    if (data.success && !data.data) {
                        log(`‚úÖ SQL injection test passed for: ${input}`, 'security-results');
                        testResults.security.sqlInjection[input] = 'PASSED';
                    } else {
                        log(`‚ùå SQL injection test failed for: ${input}`, 'security-results');
                        testResults.security.sqlInjection[input] = 'FAILED';
                    }
                } catch (error) {
                    log(`‚ùå SQL injection test error for: ${input} - ${error.message}`, 'security-results');
                    testResults.security.sqlInjection[input] = 'ERROR';
                }
            }
        }

        async function testXSSVulnerabilities() {
            log('Testing XSS vulnerabilities...', 'security-results');
            
            const xssPayloads = ["<script>alert('XSS')</script>", "javascript:alert('XSS')", "<img src=x onerror=alert('XSS')>"];
            testResults.security.xss = {};
            
            for (const payload of xssPayloads) {
                try {
                    const response = await fetch(`webgl_module_integration.php?action=list&module=clients&search=${encodeURIComponent(payload)}`);
                    const data = await response.json();
                    
                    // Check if response is successful and doesn't contain malicious content
                    if (data.success) {
                        const responseText = JSON.stringify(data);
                        if (!responseText.includes('<script>') && !responseText.includes('javascript:')) {
                            log(`‚úÖ XSS test passed for: ${payload}`, 'security-results');
                            testResults.security.xss[payload] = 'PASSED';
                        } else {
                            log(`‚ùå XSS test failed for: ${payload}`, 'security-results');
                            testResults.security.xss[payload] = 'FAILED';
                        }
                    } else {
                        log(`‚ùå XSS test failed for: ${payload} - API error`, 'security-results');
                        testResults.security.xss[payload] = 'FAILED';
                    }
                } catch (error) {
                    log(`‚ùå XSS test error for: ${payload} - ${error.message}`, 'security-results');
                    testResults.security.xss[payload] = 'ERROR';
                }
            }
        }

        // Report Generation
        async function generateComprehensiveReport() {
            log('Generating comprehensive report...', 'comprehensive-results');
            
            const report = {
                timestamp: new Date().toISOString(),
                systemStatus: systemStatus,
                testResults: testResults,
                summary: {
                    totalTests: 0,
                    passedTests: 0,
                    failedTests: 0,
                    errorTests: 0
                }
            };
            
            // Calculate summary
            for (const category in testResults) {
                for (const test in testResults[category]) {
                    report.summary.totalTests++;
                    if (testResults[category][test] === 'SUCCESS' || testResults[category][test] === 'PASSED') {
                        report.summary.passedTests++;
                    } else if (testResults[category][test] === 'FAILED') {
                        report.summary.failedTests++;
                    } else {
                        report.summary.errorTests++;
                    }
                }
            }
            
            const reportText = 
                '=== WEBGL INTERFACE COMPREHENSIVE TEST REPORT ===\n' +
                'Generated: ' + report.timestamp + '\n\n' +
                'SYSTEM STATUS:\n' +
                '- Apache: ' + (systemStatus.apache ? '‚úÖ Running' : '‚ùå Not Running') + '\n' +
                '- PHP: ' + (systemStatus.php ? '‚úÖ Working' : '‚ùå Not Working') + '\n' +
                '- Database: ' + (systemStatus.database ? '‚úÖ Connected' : '‚ùå Not Connected') + '\n' +
                '- WebGL: ' + (systemStatus.webgl ? '‚úÖ Supported' : '‚ùå Not Supported') + '\n\n' +
                'TEST SUMMARY:\n' +
                '- Total Tests: ' + report.summary.totalTests + '\n' +
                '- Passed: ' + report.summary.passedTests + '\n' +
                '- Failed: ' + report.summary.failedTests + '\n' +
                '- Errors: ' + report.summary.errorTests + '\n' +
                '- Success Rate: ' + ((report.summary.passedTests / report.summary.totalTests) * 100).toFixed(1) + '%\n\n' +
                'DETAILED RESULTS:\n' +
                JSON.stringify(testResults, null, 2) + '\n\n' +
                'RECOMMENDATIONS:\n' +
                generateRecommendations(report);
            
            log(reportText, 'comprehensive-results');
        }

        function generateRecommendations(report) {
            const recommendations = [];
            
            if (!systemStatus.apache) recommendations.push('- Fix Apache configuration');
            if (!systemStatus.php) recommendations.push('- Check PHP installation and configuration');
            if (!systemStatus.database) recommendations.push('- Verify database connection settings');
            if (!systemStatus.webgl) recommendations.push('- WebGL not supported in this browser');
            
            if (report.summary.failedTests > 0) recommendations.push('- Review failed tests and fix issues');
            if (report.summary.errorTests > 0) recommendations.push('- Investigate error conditions');
            
            return recommendations.length > 0 ? recommendations.join('\n') : '- All systems operational';
        }

        function exportTestResults() {
            const dataStr = JSON.stringify({
                timestamp: new Date().toISOString(),
                systemStatus: systemStatus,
                testResults: testResults
            }, null, 2);
            
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `webgl_test_results_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            log('Test results exported successfully', 'comprehensive-results');
        }

        function log(message, targetId = 'comprehensive-results') {
            const target = document.getElementById(targetId);
            const timestamp = new Date().toLocaleTimeString();
            target.textContent += `[${timestamp}] ${message}\n`;
            target.scrollTop = target.scrollHeight;
        }
    </script>
</body>
</html> 